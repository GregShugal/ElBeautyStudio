---
/**
 * Minimal Klaviyo signup form.
 * Replace PUBLIC_API_KEY and LIST_ID below.
 */
const { heading = 'Join the Glow List', sub = 'Skincare tips & openings.' } = Astro.props;
---
<section class="card">
  <h3 class="font-display text-2xl">{heading}</h3>
  <p class="text-sm text-[var(--muted)] mt-1">{sub}</p>
  <form id="klaviyo-subscribe" class="mt-4 space-y-3" onsubmit="return false">
    <input type="email" name="email" required placeholder="Email address" class="w-full rounded-full border px-4 py-3" />
    <button class="btn btn-primary w-full" type="submit">Join</button>
    <p id="klaviyo-msg" class="text-sm text-[var(--muted)]"></p>
  </form>
</section>

<script>
const form = document.getElementById('klaviyo-subscribe');
const msg = document.getElementById('klaviyo-msg');
if (form) {
  form.addEventListener('submit', async () => {
    const email = form.querySelector('input[name="email"]').value;
    msg.textContent = 'Submitting...';
    try {
      const resp = await fetch('https://a.klaviyo.com/client/subscriptions/?company_id=PUBLIC_API_KEY', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
        body: JSON.stringify({
          data: {
            type: 'subscription',
            attributes: {
              list_id: 'LIST_ID',
              custom_source: 'ELBSNJ Website',
              email
            }
          }
        })
      });
      if (resp.ok) {
        msg.textContent = 'Thanks! Please check your inbox.';
        form.reset();
      } else {
        msg.textContent = 'Something went wrong. Try again.';
      }
    } catch (e) {
      msg.textContent = 'Network error. Try again.';
    }
  });
}
</script>
